const e=JSON.parse(`{"key":"v-2903d112","path":"/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E5%BA%93/clickhouse.html","title":"clickhouse","lang":"zh-CN","frontmatter":{"icon":"edit","date":"2022-01-01T00:00:00.000Z","category":["数据库"],"tag":["clickhouse"],"description":"clickhouse clickhouse 常用命令 更新数据 ALTER table ads_sales_item_shop_di_replica ON CLUSTER ck_cluster1 update item_no='' where item_no is null; ALTER table ads_sales_item_shop_di_replica ON CLUSTER ck_cluster1 update store_shop_code='' where store_shop_code is null; ALTER table ads_sales_item_shop_di_replica ON CLUSTER ck_cluster1 update unify_goods_code='' where unify_goods_code is null; 重命名表 RENAME TABLE table_A TO table_A_bak, table_B TO table_B_bak; 查看所有表 select * FROM system.tables t WHERE database ='ads' AND engine &lt;&gt;'Distributed' ORDER by total_rows DESC select * FROM system.tables t WHERE database ='ads' AND engine &lt;&gt;'Distributed' and name not like '%del%' and name not like '%20%' ORDER by total_rows DESC 自动清理query_log，query_thread_log，trace_log ALTER TABLE system.query_log on cluster ck_cluster1 MODIFY TTL event_date + INTERVAL 15 DAY ALTER TABLE system.query_thread_log on cluster ck_cluster1 MODIFY TTL event_date + INTERVAL 15 DAY ALTER TABLE system.trace_log on cluster ck_cluster1 MODIFY TTL event_date + INTERVAL 15 DAY 立即清理 alter table system.query_thread_log_0 drop partition '202105' 分区名可以用下语句查询 select * from system.parts p where table = '表名' 查看parts select * from system.parts where table = 'abs_activity_item_info_day_replica' select * from system.parts where active = 0 当前慢查询 SELECT * FROM system.processes limit 100 耗时大于60秒 kill query where elapsed &gt;= 60 clickhouse不能创建等执行操作时（每个节点都要执行） select * from system.mutations where is_done = 0; kill mutation ON CLUSTER ck_cluster1 where database='ads' and table='ads_jd_erp_sale_outstock_replica' 进入zk清理任务 deleteall /clickhouse/distributed_ddl/query-0000011932 查询阻塞的任务 select * from system.distributed_ddl_queue where status != 'Finished' 查看表大小 SELECT table AS \`表名\`, sum(rows) AS \`总行数\`, formatReadableSize(sum(data_uncompressed_bytes)) AS \`原始大小\`, formatReadableSize(sum(data_compressed_bytes)) AS \`压缩大小\`, round((sum(data_compressed_bytes) / sum(data_uncompressed_bytes)) * 100, 0) AS \`压缩率\` FROM system.parts GROUP BY table order by sum(data_compressed_bytes) desc 修改字段名 ALTER TABLE visits RENAME COLUMN webBrowser TO browser 分布式集群下用分布式DDL修改字段名 ALTER TABLE visits on cluster shipin_cluster RENAME COLUMN webBrowser TO browser 新增字段 alter table ads_itemprice_sales_section_replica ON CLUSTER ck_cluster1 add column sort_mark Nullable(int) alter table ads_itemprice_sales_section ON CLUSTER ck_cluster1 add column sort_mark Nullable(int)","head":[["meta",{"property":"og:url","content":"https://www.cizai.io/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E5%BA%93/clickhouse.html"}],["meta",{"property":"og:site_name","content":"此在笔记"}],["meta",{"property":"og:title","content":"clickhouse"}],["meta",{"property":"og:description","content":"clickhouse clickhouse 常用命令 更新数据 ALTER table ads_sales_item_shop_di_replica ON CLUSTER ck_cluster1 update item_no='' where item_no is null; ALTER table ads_sales_item_shop_di_replica ON CLUSTER ck_cluster1 update store_shop_code='' where store_shop_code is null; ALTER table ads_sales_item_shop_di_replica ON CLUSTER ck_cluster1 update unify_goods_code='' where unify_goods_code is null; 重命名表 RENAME TABLE table_A TO table_A_bak, table_B TO table_B_bak; 查看所有表 select * FROM system.tables t WHERE database ='ads' AND engine &lt;&gt;'Distributed' ORDER by total_rows DESC select * FROM system.tables t WHERE database ='ads' AND engine &lt;&gt;'Distributed' and name not like '%del%' and name not like '%20%' ORDER by total_rows DESC 自动清理query_log，query_thread_log，trace_log ALTER TABLE system.query_log on cluster ck_cluster1 MODIFY TTL event_date + INTERVAL 15 DAY ALTER TABLE system.query_thread_log on cluster ck_cluster1 MODIFY TTL event_date + INTERVAL 15 DAY ALTER TABLE system.trace_log on cluster ck_cluster1 MODIFY TTL event_date + INTERVAL 15 DAY 立即清理 alter table system.query_thread_log_0 drop partition '202105' 分区名可以用下语句查询 select * from system.parts p where table = '表名' 查看parts select * from system.parts where table = 'abs_activity_item_info_day_replica' select * from system.parts where active = 0 当前慢查询 SELECT * FROM system.processes limit 100 耗时大于60秒 kill query where elapsed &gt;= 60 clickhouse不能创建等执行操作时（每个节点都要执行） select * from system.mutations where is_done = 0; kill mutation ON CLUSTER ck_cluster1 where database='ads' and table='ads_jd_erp_sale_outstock_replica' 进入zk清理任务 deleteall /clickhouse/distributed_ddl/query-0000011932 查询阻塞的任务 select * from system.distributed_ddl_queue where status != 'Finished' 查看表大小 SELECT table AS \`表名\`, sum(rows) AS \`总行数\`, formatReadableSize(sum(data_uncompressed_bytes)) AS \`原始大小\`, formatReadableSize(sum(data_compressed_bytes)) AS \`压缩大小\`, round((sum(data_compressed_bytes) / sum(data_uncompressed_bytes)) * 100, 0) AS \`压缩率\` FROM system.parts GROUP BY table order by sum(data_compressed_bytes) desc 修改字段名 ALTER TABLE visits RENAME COLUMN webBrowser TO browser 分布式集群下用分布式DDL修改字段名 ALTER TABLE visits on cluster shipin_cluster RENAME COLUMN webBrowser TO browser 新增字段 alter table ads_itemprice_sales_section_replica ON CLUSTER ck_cluster1 add column sort_mark Nullable(int) alter table ads_itemprice_sales_section ON CLUSTER ck_cluster1 add column sort_mark Nullable(int)"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-07-13T10:52:36.000Z"}],["meta",{"property":"article:author","content":"cizai"}],["meta",{"property":"article:tag","content":"clickhouse"}],["meta",{"property":"article:published_time","content":"2022-01-01T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-07-13T10:52:36.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"clickhouse\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2022-01-01T00:00:00.000Z\\",\\"dateModified\\":\\"2023-07-13T10:52:36.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"cizai\\",\\"url\\":\\"https://www.cizai.io\\"}]}"]]},"headers":[{"level":2,"title":"clickhouse 常用命令","slug":"clickhouse-常用命令","link":"#clickhouse-常用命令","children":[]},{"level":2,"title":"clickhouse表引擎","slug":"clickhouse表引擎","link":"#clickhouse表引擎","children":[]},{"level":2,"title":"clickhouse性能优化","slug":"clickhouse性能优化","link":"#clickhouse性能优化","children":[]},{"level":2,"title":"clickhouse 创建表等命令","slug":"clickhouse-创建表等命令","link":"#clickhouse-创建表等命令","children":[]}],"git":{"createdTime":1689218642000,"updatedTime":1689245556000,"contributors":[{"name":"lijc210","email":"lijc210@163.com","commits":3}]},"readingTime":{"minutes":20.29,"words":6086},"filePathRelative":"大数据/数据库/clickhouse.md","localizedDate":"2022年1月1日","excerpt":"<h1> clickhouse</h1>\\n<h2> clickhouse 常用命令</h2>\\n<div class=\\"language-text line-numbers-mode\\" data-ext=\\"text\\"><pre class=\\"language-text\\"><code>更新数据\\nALTER table ads_sales_item_shop_di_replica ON CLUSTER ck_cluster1 update item_no='' where item_no is null;\\nALTER table ads_sales_item_shop_di_replica ON CLUSTER ck_cluster1 update store_shop_code='' where store_shop_code is null;\\nALTER table ads_sales_item_shop_di_replica ON CLUSTER ck_cluster1 update unify_goods_code='' where unify_goods_code is null;\\n\\n\\n重命名表\\nRENAME TABLE table_A TO table_A_bak, table_B TO table_B_bak;\\n\\n\\n\\n查看所有表\\nselect *\\nFROM system.tables t WHERE database ='ads' AND engine &lt;&gt;'Distributed' ORDER by total_rows DESC \\n\\n\\nselect *\\nFROM system.tables t WHERE database ='ads'\\nAND engine &lt;&gt;'Distributed'\\nand name not like '%del%'\\nand name not like '%20%'\\nORDER by total_rows DESC\\n\\n\\n\\n自动清理query_log，query_thread_log，trace_log\\n\\nALTER TABLE system.query_log on cluster ck_cluster1 MODIFY TTL event_date + INTERVAL 15 DAY\\n\\nALTER TABLE system.query_thread_log on cluster ck_cluster1 MODIFY TTL event_date + INTERVAL 15 DAY\\n\\nALTER TABLE system.trace_log on cluster ck_cluster1 MODIFY TTL event_date + INTERVAL 15 DAY\\n\\n立即清理\\nalter table system.query_thread_log_0 drop partition '202105'\\n分区名可以用下语句查询\\nselect * from system.parts p where table = '表名'\\n\\n查看parts  \\nselect * from system.parts  where table = 'abs_activity_item_info_day_replica'\\nselect * from system.parts where active = 0\\n当前慢查询\\nSELECT * FROM system.processes limit 100\\n\\n耗时大于60秒\\nkill query where elapsed &gt;= 60\\n\\nclickhouse不能创建等执行操作时（每个节点都要执行）\\nselect * from system.mutations where is_done = 0;\\nkill mutation ON CLUSTER ck_cluster1 \\n where database='ads' and table='ads_jd_erp_sale_outstock_replica' \\n\\n\\n进入zk清理任务\\ndeleteall /clickhouse/distributed_ddl/query-0000011932\\n查询阻塞的任务\\nselect * from system.distributed_ddl_queue where status != 'Finished'\\n\\n\\n查看表大小\\nSELECT\\n    table AS \`表名\`,\\n    sum(rows) AS \`总行数\`,\\n    formatReadableSize(sum(data_uncompressed_bytes)) AS \`原始大小\`,\\n    formatReadableSize(sum(data_compressed_bytes)) AS \`压缩大小\`,\\n    round((sum(data_compressed_bytes) / sum(data_uncompressed_bytes)) * 100, 0) AS \`压缩率\`\\nFROM system.parts\\nGROUP BY table\\norder by sum(data_compressed_bytes) desc\\n\\n\\n修改字段名\\nALTER TABLE visits RENAME COLUMN webBrowser TO browser\\n分布式集群下用分布式DDL修改字段名\\nALTER TABLE visits on cluster shipin_cluster RENAME COLUMN webBrowser TO browser\\n\\n\\n新增字段\\n alter table ads_itemprice_sales_section_replica ON CLUSTER ck_cluster1 add column sort_mark Nullable(int)\\n alter table ads_itemprice_sales_section ON CLUSTER ck_cluster1 add column sort_mark Nullable(int)\\n</code></pre><div class=\\"line-numbers\\" aria-hidden=\\"true\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}`);export{e as data};
